<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title><%= pageTitle %></title>

    <!-- Styles File -->
    <link rel="stylesheet" href="/client/setup.css" />
    <link rel="stylesheet" href="/client/styles/partials/header.css" />
    <link rel="stylesheet" href="/client/styles/pages/index/index.css" />
    <link rel="stylesheet" href="/client/styles/pages/index/index.responsive.css" />
    <link rel="stylesheet" href="/client/styles/pages/product/detail.css" />
    <link rel="stylesheet" href="/client/styles/partials/footer.css" />
    <!-- End Styles File -->

    <!-- Styles Library & Framework Link -->
    <!-- Bootstrap -->
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.5/dist/css/bootstrap.min.css"
    />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css"
    />
    <!-- BoxIcon -->
    <link href="https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css" rel="stylesheet" />
    <!-- SlickSlide -->
    <link
      rel="stylesheet"
      type="text/css"
      href="//cdn.jsdelivr.net/npm/slick-carousel@1.8.1/slick/slick.css"
    />
    <!-- End Styles Library & Framework Link -->

    <style>
      .text-to-html img {
        max-width: 100% !important;
      }
    </style>
  </head>
  <body>
    <%-include('../../partials/header.view.ejs', { categoryListTree: categoryTree, homeActive: '',
    aboutActive: '', productActive: "active", newsActive: '', contactActive: '', cartActive: '' });
    %> <%-include("../../partials/header-mobile.view.ejs") %>

    <main class="main">
      <!-- Prroduct detail -->
      <section class="product__detail pt-5">
        <div class="container">
          <div class="row">
            <div class="col-lg-6">
              <!-- Product detail thumbnail -->
              <div class="product__detail-thumbnail border mb-3 d-flex justify-content-center">
                <img
                  width="100%"
                  class="product__thumbnail-image fit"
                  src="<%= product.thumbnail %>"
                />
              </div>

              <!-- Product detail image list -->
              <div class="product__detail-image d-flex justify-content-center mb-3">
                <% for(let i = 0; i < product.images.length; i++) { %>
                <img
                  width="60"
                  height="60"
                  class="product__image-item border me-2"
                  src="https://mdbcdn.b-cdn.net/img/bootstrap-ecommerce/items/detail1/big1.webp"
                />
                <% } %>
              </div>
            </div>

            <!-- Product details info -->
            <div class="col-lg-6">
              <div class="product__info ps-lg-3">
                <h4 class="heading-font product__info-title mb-3"><%= product.title %></h4>
                <div class="d-flex flex-row my-3">
                  <div class="content-font product__info-rating rating__star mb-1 me-2">
                    <% for (let i = 0; i < product.rating; i++) { %><i class="fas fa-star"></i><% }
                    %>
                    <span class="product__info-rating rating__number ms-1">
                      <%= product.rating %>
                    </span>
                  </div>
                  <% if(product.stock <= 0) { %>
                  <span
                    class="content-font product__info-stock mb-1"
                    style="color: var(--error-color)"
                    ><i class="fas fa-shopping-basket fa-sm mx-1"></i>Đã hết hàng</span
                  >
                  <% } else { %>
                  <span class="content-font product__info-stock mb-1"
                    ><i class="fas fa-shopping-basket fa-sm mx-1"></i>Còn
                    <span class="content-font info__stock-number fw-bold"
                      ><%= product.stock %></span
                    >
                    mặt hàng</span
                  >
                  <span class="content-font text-success ms-2">trong kho</span>
                  <% } %>
                </div>

                <div class="mb-3">
                  <span class="title-font product__info-discount h5"
                    ><%= new Intl.NumberFormat('vi-VN', { style: 'currency', currency: 'VND'
                    }).format(Number.parseFloat(product.price - (product.price / 100 *
                    product.discount))) %></span
                  >
                  <span class="product__info-price content-font text-decoration-line-through"
                    ><%= new Intl.NumberFormat('vi-VN', { style: 'currency', currency: 'VND'
                    }).format(product.price) %></span
                  >
                </div>

                <p class="content-font product__info-description mb-4">
                  <%= product.description %>
                </p>

                <div class="row">
                  <dt class="product__info-categoty category__title col-4">Thể loại:</dt>
                  <dd class="product__info-categoty category__content content-font col-8">
                    <%= category.title %>
                  </dd>

                  <dt class="product__info-brand brand__title col-4">Thương hiệu:</dt>
                  <dd class="product__info-brand brand__content content-font col-8">
                    <%= product.brand %>
                  </dd>
                </div>

                <hr />

                <form action="/cart/add/<%= product.id %>" method="POST" class="product__info-form">
                  <div class="product__info-button row mb-4">
                    <div class="col-md-4 col-6 mb-3">
                      <label class="product__info-label content-font mb-2 d-block"
                        ><b>Số lượng</b></label
                      >
                      <div class="product__info-box input-group mb-3">
                        <button
                          class="product__info-decrease button-icon-secondary"
                          type="button"
                          id="button-addon1"
                          data-mdb-ripple-color="dark"
                        >
                          <i class="fas fa-minus"></i>
                        </button>
                        <input
                          name="quantity"
                          type="number"
                          class="product__info-quantity form-control text-center border border-secondary"
                          placeholder="Số lượng..."
                          value="1"
                          min="1"
                          step="1"
                          aria-label="Example text with button addon"
                          aria-describedby="button-addon1"
                        />
                        <button
                          class="product__info-increase button-icon-secondary"
                          type="button"
                          id="button-addon2"
                          data-mdb-ripple-color="dark"
                        >
                          <i class="fas fa-plus"></i>
                        </button>
                      </div>
                    </div>
                  </div>
                  <% if (product.stock > 0) { %>
                  <button href="#" class="button-primary text-decoration-none">Buy now</button>
                  <button type="submit" class="button-secondary text-decoration-none add-to-cart">
                    <i class="me-1 fa fa-shopping-basket"></i> Add to cart
                  </button>
                  <% } %>
                  <button href="#" class="button-primary text-decoration-none">
                    <i class="me-1 fa fa-heart fa-lg"></i> Save
                  </button>
                </form>
              </div>
            </div>
          </div>
        </div>
      </section>
      <!-- End product detail -->

      <!-- Start product detail description -->
      <section class="pt-5 product-format_detail">
        <div class="container">
          <div class="row">
            <div class="col-12">
              <div class="product-format_detail-content text-to-html"><%= product.detail %></div>
            </div>
          </div>
        </div>
      </section>
      <!-- End product detail description -->

      <!-- Start related products -->
      <section class="pb-5 related-products">
        <h3 class="heading-font text-center related-products__title">Sản phẩm liên quan</h3>

        <div class="container">
          <div class="row justify-content-center g-2">
            <% if(relatedProductList.length === 0) { %><span class="content-font text-center"
              >(Không tìm thấy sản phẩm phù hợp)</span
            ><% } %> <% relatedProductList.forEach(product => { %>
            <div class="col-lg-2 col-md-4 col-6">
              <div class="card__bg" title="<%= product.title %>">
                <div class="card__image">
                  <img
                    src="<%= product.thumbnail %>"
                    alt="product"
                    width="100%"
                    class="card__thumbnail"
                  />
                  <div class="card__link">
                    <a
                      href="/products/detail/<%= product.slug %>"
                      class="content-font card__link-detail"
                      >Xem chi tiết</a
                    >
                  </div>
                </div>
                <div class="content-font card__title mt-1">
                  <% if(product.title.length > 25) { %> <%= product.title.slice(0, 25) + '...' %> <%
                  } else { %> <%= product.title %> <% } %>
                </div>
                <div class="card__box d-flex justify-content-between align-items-center">
                  <h5 class="title-font card__price">
                    <%= new Intl.NumberFormat('vi-VN', { style: 'currency', currency: 'VND'
                    }).format(Number.parseFloat(product.price - (product.price / 100 *
                    product.discount))) %>
                  </h5>
                  <div class="card__favorite">
                    <i class="bi bi-suit-heart-fill"></i>
                  </div>
                </div>
                <div class="content-font text-danger text-decoration-line-through">
                  Giá gốc: <%= new Intl.NumberFormat('vi-VN', { style: 'currency', currency: 'VND'
                  }).format(product.price) %>
                </div>
                <div class="card__rating d-flex justify-content-between align-items-center">
                  <div class="card__star">
                    <% for(let i = 1; i <= product.rating; i++) { %>
                    <i class="bi bi-star-fill"></i>
                    <% } %>
                  </div>
                  <form <% if(product.stock>
                    0) { %> action="/cart/add/<%= product.id %>" method="POST" <% } %>>
                    <button type="submit" class="border-0 bg-transparent">
                      <i title="add to cart" class="bi bi-bag-check-fill"></i>
                    </button>
                  </form>
                </div>
              </div>
            </div>
            <% }) %>
          </div>
        </div>
      </section>
      <!-- End related products -->
    </main>

    <form
      action="/cart/delete"
      method="POST"
      class="d-none form-delete-product-cart"
      id="form-delete-product-cart"
    ></form>

    <form
      action="/cart/change-quantity"
      method="POST"
      class="d-none form-change-quantity-cart"
      id="form-change-quantity-cart"
    ></form>

    <%-include("../../partials/footer.view.ejs") %>

    <!-- Scripts File -->
    <script src="/client/scripts/toggleHeaderMobile.js"></script>
    <script src="/client/scripts/customInputRange.js"></script>
    <script src="/client/scripts/product/showProductFilter.js"></script>
    <script src="/client/scripts/product/handleQuantityCart.js"></script>
    <script src="/client/scripts/cart/deleteProductInCart.js"></script>
    <script src="/client/scripts/cart/changeProductQuantity.js"></script>
    <!-- End Scripts File -->

    <!-- Scripts Library & Framework Link -->
    <!-- Bootstrap -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <!-- FontAwesome -->
    <script src="https://kit.fontawesome.com/aaf479b433.js" crossorigin="anonymous"></script>
    <!-- SlickSlide -->
    <script type="text/javascript" src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script
      type="text/javascript"
      src="//cdn.jsdelivr.net/npm/slick-carousel@1.8.1/slick/slick.min.js"
    ></script>
    <script type="text/javascript" src="/client/scripts/slickslide.js"></script>

    <script src="https://cdn.jsdelivr.net/npm/he/he.js"></script>
    <script src="/client/scripts/changeTextToHtml.js"></script>

    <!-- <script src="./scripts/googlemap.js"></script> -->
    <!-- End Scripts Library & Framework Link -->

    <script src="/reload/reload.js"></script>
  </body>
</html>
